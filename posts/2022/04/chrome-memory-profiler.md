---
title: '크롬 매모리 프로파일러 사용하는 방법'
tags:
  - javascript
  - chrome
published: true
date: 2022-04-28 20:18:04
description: '스냅샷 해석과 디버깅의 책임은 본인에게 있습니다'
---

## Table of Contents

## Introduction

웹 애플리케이션 성능 최적화 내지는 메모리 이슈를 해결하기 위해서 이것저것 뒤지다보면, 결국 최종적으로 확인해봐야 할 것은 바로 이 메모리 프로파일링 탭이다. 이 탭을 통해 웹 애플리케이션에서 메모리 누수가 일어나고 있는지, 또 메모리를 최대한 효율적으로 사용하고 있는지를 확인하기 위해서는, 이 메모리 프로파일링 탭을 읽을 수 있어야 한다. 마침 크롬 버전이 업데이트 되면서 (꽤 되긴했지만) 친절하게 크롬의 디버그 도구가 한글로 번역까지 되어 있다.

본격적으로 탭을 살펴보기에 앞서, 크롬 메모리 프로파일러를 처음 보면 매우 혼란스럽다. 친절한 자바스크립트 코드를 보다가 포인터와 각종 희한한 정보들을 살펴보다면 매우 혼란스러울 것이다. 그래서 본격적으로 우리가 (혹은 내가) 만든 페이지를 디버깅 하기에 앞서, 빈 html 태그만 있는 페이지를 기준으로 살펴보려고 한다.

HTML의 역사는 매우매우 오래되었고 또 갖가지 문법들이 유서깊게 짬뽕되어 있기 때문에, 우리가 빈 `<html/>` 문서만 만들어도 크롬은 알아서 `head`와 `body` 삽입해서 기본적인 HTML 트리를 만들어 준다. 아무튼, 이 빈 `<html/>`을 시작으로 크롬 메모리 탭에서 무슨 일이 일어나고 있는지 살펴보자.

## 빈페이지

```html
<html />
```

위 파일을 별도 html로 저장한 다음에 시크릿탭으로 페이지를 한번 열어보자. 꼭 시크릿탭으로 여는 것이 좋다. 그렇지 않으면 안그래도 정신사나운 정보들에 추가로 익스텐션 정보들까지 달라붙어 매우 읽기 어려워진다.

![chrome-memory-profiler1](./images/chrome-memory-profiler1.png)

힙 스냅샷 하단에 있는 숫자값을 포함할지 여부를 꼭 선택하자. [이전 포스트](/2022/04/how-javascript-variable-works-in-memory#숫자는-조금-복잡)에서 살펴보았던 것처럼, `smi` 숫자는 관리 방식이 달라 이것을 체크하지 않으면 숫자값을 볼 수 없다.

![chrome-memory-profiler2](./images/chrome-memory-profiler2.png)

놀랍게도, 아무것도 없는 말그대로 빈페이지 주제에 단순히 빈 페이지를 렌더링하는데에도 많은 오브젝트가 관여되어 있는 것을 볼 수 있다. 이 페이지가 로드된 이후, 인스턴스화된 각 자바스크립트 객체는 해당 생성자 클래스 아래에 그룹화되어 있는 것을 볼 수 있다. 괄호로 쳐져있는 그룹 `()`은 직접 호출할 수 없는 네이티브 생성자를 나타낸다. 위 그림에서 보면 많은 `(compiled code)` `(system)` 등도 볼 수 있고, 그리고 `Date` `String` `RangeError` 과 같은 전통적인 자바스크립트 객체도 볼 수 있다.

이 모든 것을 이해하기 위해서, 유저가 간단하게 버튼을 눌러서 동작하는 작업을 추가해보자.

```html
<html>
  <head>
    <script>
      var counter = 0
      var instances = []

      function X() {
        this.i = counter++
      }

      function allocate() {
        instances.push(new X())
      }
    </script>
  </head>
  <body>
    <button onclick="allocate()">Allocate</button>
  </body>
</html>
```
