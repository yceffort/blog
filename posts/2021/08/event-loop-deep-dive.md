---
title: 'Nodejs의 이벤트 루프 깊게 살펴보기'
tags:
  - nodejs
  - javascript
  - event-loop
published: true
date: 2021-08-31 21:38:06
description: ''
---

## Table of Contents

## Overview

Nodejs가 다른 프로그래밍 플랫폼과 구별되는 특징은 I/O를 처리하는 방식이다. Nodejs를 소개할 때 마다 항상 반복해서 하는 얘기는 _구글 v8 자바스크립트 엔진 기반의 논블로킹, 이벤트 기반 플랫폼_ 라는 것이다. _논블로킹_, *이벤트 기반*이라는 것은 무슨 뜻일까? 이 모든 것에 대한 대답은 Nodejs의 중심인 이벤트 루프에 있다. 이벤트 루프는 무엇인지, 작동방식은 어떤지, 애플리케이션에 어떻게 영향을 미치는지, 어떻게 해야 최상의 결과를 얻을 수 있을까?

## 반응형 패턴

Nodejs는 **Event Demultiplexers** 및 **이벤트 큐**를 포함하고 있는 이벤트 기반 모델로 작동한다. 모든 I/O 요청은 완료/실패 또는 또다른 트리거를 발생시킨다. 이를 **이벤트** 라고 한다. 이러한 이벤트는 다음 알고리즘에 따라서 처리된다.

1. Event Demultiplexers는 I/O 요청을 받고, 이러한 요청을 적절한 하드웨어에 위임한다.
2. I/O 요청이 처리되면 (파일에 있는 데이터 읽기, 소켓에 있는 데이터 읽기 등) Event Demultiplexers는 처리해야할 특정 작업에 등록되어 있는 콜백 핸들러를 큐에 추가한다. 여기서 말하는 콜백을 이벤트라고 하고, 이벤트가 추가되는 큐를 이벤트 큐라고 한다.
3. 이벤트 큐에서 이벤트를 처리할 수 있는 경우, 이벤트를 수신한 순서대로 큐이 빌 때 까지 순차적으로 실행한다.
4. 이벤트 큐에 더이상 이벤트가 없거나, Event Demultiplexer에 더이상 보류 중인 요청이 없는 경우, 프로그램이 완료된다. 그렇지 않으면, 다시 첫 번째 단계 부터 프로세스가 계속된다.

이 전체 매커지늠을 조율하는 프로그램을 **이벤트 루프** 라한다.

![event-loop](https://miro.medium.com/max/1122/1*3fzASvL5gFrSC64hHKzQOQ.jpeg)

이벤트 루프는 단일 스레드이며, 반 무한 (semi-infinite) 루프다. 이것을 무한이 아닌 반 무한이라고 부르는 이유는, 더 이상 할일이 없는 시점에는 멈추기 때문이다. 개발자 관점에서 보자면, 여기에서 프로그램이 종료되는 것이다.

위 그림은, nodejs가 어떻게 작동하는지와, 이른바 [리액터 패턴](https://ko.wikipedia.org/wiki/%EB%B0%98%EC%9D%91%EC%9E%90_%ED%8C%A8%ED%84%B4) 이라고 불리우는 디자인 패턴의 주요 컴포넌트들을 보여 주고 있다. 하지만 실제로는 이것보다 훨씬 더 복잡하다.

## Event Demultiplexer

